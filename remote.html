<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NED SaaS Control - Remote</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; font-family: sans-serif; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="text-white flex flex-col items-center justify-center min-h-screen p-6">
    <div class="glass-card w-full max-w-sm rounded-[2rem] p-8 shadow-2xl border-t-4 border-t-blue-500">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-black text-blue-400 italic">NED CLOUD</h1>
            <p class="text-[10px] text-slate-500 font-mono tracking-widest uppercase">Remote Control V1</p>
        </div>
        <div class="space-y-4">
            <button onclick="updateRemote('ACTIVE')" class="w-full bg-emerald-600 hover:bg-emerald-500 p-5 rounded-2xl font-black shadow-lg transition-transform active:scale-95 flex justify-between items-center">
                <span>فتح السيستم (ACTIVE)</span>
                <span class="text-xs bg-black/20 px-2 py-1 rounded">ON</span>
            </button>
            <button onclick="updateRemote('BLOCKED')" class="w-full bg-red-600 hover:bg-red-500 p-5 rounded-2xl font-black shadow-lg transition-transform active:scale-95 flex justify-between items-center">
                <span>قفل السيستم (BLOCKED)</span>
                <span class="text-xs bg-black/20 px-2 py-1 rounded">OFF</span>
            </button>
        </div>
        <div id="msg" class="mt-6 text-center text-xs font-bold py-2 px-4 rounded-lg hidden"></div>
    </div>

    <script>
        async function updateRemote(status) {
            const msgDiv = document.getElementById('msg');
            msgDiv.className = "mt-6 text-center text-xs font-bold py-2 px-4 rounded-lg block bg-blue-900/30 text-blue-400";
            msgDiv.innerText = "جاري الاتصال بالسحاب... ⚡";

            let token = localStorage.getItem('NED_KEY');
            if(!token) {
                token = prompt("من فضلك ادخل الـ GitHub Token بتاعك (مرة واحدة فقط):");
                if(token) localStorage.setItem('NED_KEY', token);
            }

            try {
                const config = {
                    owner: "dlta17",
                    repo: "ned-fashion-pos",
                    path: "ned_cloud_server.json",
                    hwid: "HW-9ED8D93E"
                };

                const res = await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`, {
                    headers: { 'Authorization': `token ${token}` }
                });
                const fileData = await res.json();

                const payload = {
                    stores: { [config.hwid]: { status: status, lastSync: new Date().toISOString() } }
                };

                const encrypted = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
                const finalJson = JSON.stringify({ cloud_payload: encrypted }, null, 2);

                const update = await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Remote Control: ${status}`,
                        content: btoa(unescape(encodeURIComponent(finalJson))),
                        sha: fileData.sha
                    })
                });

                if (update.ok) {
                    msgDiv.innerText = `✅ تم الـ ${status} بنجاح!`;
                    msgDiv.className = "mt-6 text-center text-xs font-bold py-2 px-4 rounded-lg block bg-emerald-900/30 text-emerald-400";
                } else { throw new Error("فشل في التحديث"); }
            } catch (err) {
                msgDiv.innerText = "❌ خطأ في التوكن أو الاتصال";
                msgDiv.className = "mt-6 text-center text-xs font-bold py-2 px-4 rounded-lg block bg-red-900/30 text-red-400";
                localStorage.removeItem('NED_KEY');
            }
        }
    </script>
</body>
</html>